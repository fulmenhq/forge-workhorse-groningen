# Release Checklist

Standard checklist for forge-workhorse-groningen releases to ensure consistency and quality.

## Pre-Release Phase

### Version Planning

- [ ] Feature briefs completed in `.plans/active/<version>/`
- [ ] All planned features implemented and tested
- [ ] Breaking changes documented
- [ ] Migration guide written (if applicable)
- [ ] Version number decided (semantic versioning: MAJOR.MINOR.PATCH)

### Code Quality

- [ ] All tests passing: `make test`
- [ ] Code formatted: `make fmt`
- [ ] Lint checks clean: `make lint`
- [ ] Application builds: `make build`
- [ ] Manual smoke tests completed:
  - [ ] `./bin/groningen version`
  - [ ] `./bin/groningen serve` (starts without errors)
  - [ ] `./bin/groningen health`
  - [ ] Graceful shutdown (Ctrl+C)

### Documentation

- [ ] `RELEASE_NOTES.md` updated with new version section
- [ ] `README.md` reviewed and updated
- [ ] CDRL guide reflects any workflow changes
- [ ] Feature documentation added to `docs/` (if applicable)
- [ ] `.fulmen/app.yaml` comments accurate for template users

### Dependencies

- [ ] `go.mod` dependencies reviewed
- [ ] Local replace directives removed (switch to GitHub releases)
- [ ] Dependency versions finalized
- [ ] `go mod tidy` executed
- [ ] No security vulnerabilities in dependencies

## Release Preparation

### Version Updates

- [ ] Update VERSION file (if exists) or version constant
- [ ] Update version in relevant documentation
- [ ] Search for hardcoded version references
- [ ] Update docker/container image tags (if applicable)

### Git Hygiene

- [ ] All changes committed
- [ ] Commit messages follow attribution standard
- [ ] No uncommitted changes: `git status` clean
- [ ] All commits have proper trailers:
  - [ ] `Generated by <agent> under supervision of @3leapsdave`
  - [ ] `Co-Authored-By: <agent> <email>`
  - [ ] `Committer-of-Record: <human> <email> [@handle]`

### Final Validation

- [ ] Fresh clone test: Clone repo fresh, run `make build && make test`
- [ ] CDRL workflow test: Simulate user refitting template
  - [ ] Clone template
  - [ ] Update `.fulmen/app.yaml`
  - [ ] Update `go.mod` module path
  - [ ] Run `make build` - verify new identity used
- [ ] Integration tests pass (if applicable)
- [ ] Performance benchmarks acceptable (if applicable)

## Release Execution

### Release Artifacts & Signing (manual, template-friendly)

Follow the Fulmen “manifest-only” provenance pattern:

- Generate SHA256 + SHA512 manifests
- Sign manifests with minisign (primary) and optionally PGP
- Ship trust anchors (public keys) with the release

- [ ] Stage clean artifacts and generate manifests: `make release-build`
  - This runs: `release-clean` → build cross-platform binaries into `dist/release/` → `make checksums`.
  - `make release-sign` does **not** build or download artifacts; it only signs existing `SHA256SUMS`/`SHA512SUMS`.
- [ ] Validate manifests match artifacts: `make verify-checksums`
- [ ] Sign manifests (minisign required; PGP optional):

  ```bash
  export RELEASE_TAG=v<version>
  export GRONINGEN_MINISIGN_KEY=/path/to/groningen.key
  export GRONINGEN_MINISIGN_PUB=/path/to/groningen.pub
  export GRONINGEN_PGP_KEY_ID="security@fulmenhq.dev"   # optional (may be a signing subkey/fpr depending on key layout)
  export GRONINGEN_GPG_HOME=/path/to/gnupg-fulmenhq       # required if PGP_KEY_ID is set
  make release-sign
  ```

- [ ] Export public keys into `dist/release/`: `make release-export-keys`
- [ ] Verify exported keys are public-only: `make verify-release-keys`
- [ ] Copy release notes into `dist/release/`: `make release-notes`
- [ ] Upload provenance assets (manifests + signatures + public keys + notes): `make release-upload`
  - If you are doing a fully manual release build (no CI artifacts), use: `make release-upload-all`

**CDRL note**: downstream users should refit the `<APP>_…` env var prefix (e.g. `GRONINGEN_MINISIGN_KEY` → `MYAPI_MINISIGN_KEY`).

### Tagging

- [ ] Create annotated git tag: `git tag -a v<version> -m "Release v<version>"`
- [ ] Verify tag: `git tag -v v<version>`
- [ ] Tag message includes brief release summary

### Publishing

- [ ] Push commits: `git push origin main`
- [ ] Push tag: `git push origin v<version>`
- [ ] Verify GitHub release appears
- [ ] Create GitHub Release notes from RELEASE_NOTES.md

### Distribution

- [ ] Verify `go get github.com/fulmenhq/forge-workhorse-groningen@v<version>` works
- [ ] Test template instantiation from fresh clone
- [ ] Update any downstream references (if applicable)

## Post-Release

### Communication

- [ ] Announce release in Mattermost `#agents-groningen`
- [ ] Update project README badges (if applicable)
- [ ] Notify gofulmen team if integration patterns changed

### Housekeeping

- [ ] Archive old release notes to `docs/releases/` (keep only latest 3 in RELEASE_NOTES.md)
- [ ] Clean up `.plans/active/<old-version>/` (move to `.plans/archive/` if needed)
- [ ] Update template usage examples (if applicable)
- [ ] Plan next version features

### Monitoring

- [ ] Monitor GitHub issues for release-related bugs
- [ ] Check template adoption metrics (if available)
- [ ] Gather feedback from CDRL users

## Version-Specific Checklists

### For Major Releases (x.0.0)

- [ ] Breaking changes documented with upgrade guide
- [ ] Deprecation warnings added to old APIs
- [ ] Migration scripts provided (if complex changes)
- [ ] Announcement prepared for ecosystem impact
- [ ] Backward compatibility strategy documented

### For Minor Releases (0.x.0)

- [ ] New features documented with examples
- [ ] CDRL workflow validated with new features
- [ ] Integration tests cover new functionality
- [ ] Feature flags documented (if applicable)

### For Patch Releases (0.0.x)

- [ ] Bug fixes documented with issue references
- [ ] Regression tests added for fixed bugs
- [ ] Security patches highlighted (if applicable)
- [ ] No new features or breaking changes

## Emergency Hotfix Process

### Hotfix Identification

- [ ] Critical bug or security issue identified
- [ ] Severity assessed (production-impacting?)
- [ ] Hotfix branch created: `hotfix/v<version>`

### Rapid Development

- [ ] Minimal fix implemented
- [ ] Tests added for regression prevention
- [ ] Code review expedited (but not skipped)
- [ ] Quality gates still enforced (no shortcuts)

### Hotfix Release

- [ ] Version bumped (patch level)
- [ ] Release notes include "Hotfix" designation
- [ ] Tag pushed immediately after merge
- [ ] Users notified of critical update

### Post-Hotfix

- [ ] Root cause analysis documented
- [ ] Process improvements identified
- [ ] Monitoring enhanced to catch similar issues

## Notes

- This checklist is aspirational and may evolve with project maturity
- Some items may not apply to all releases (use judgment)
- Prioritize quality over speed - never skip tests or code review
- When in doubt, consult @3leapsdave before proceeding
